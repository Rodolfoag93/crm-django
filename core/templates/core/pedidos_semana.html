{% extends 'core/base.html' %}

{% block content %}
<h2 style="text-align:center; margin-top: 20px;">Pedidos de la Semana</h2>

<p style="text-align:center;">
    Del <strong>{{ inicio_semana }}</strong> al <strong>{{ fin_semana }}</strong>
</p>

<div style="width: 90%; margin: auto; text-align: right; margin-bottom: 20px; display:flex; justify-content:flex-end; gap:15px;">
    <a href="{% url 'nuevo_gasto' %}" style="padding: 10px 15px; background-color: #e53935; color: white; text-decoration: none; border-radius: 6px; font-weight: bold;">
        â• Registrar Gasto
    </a>
    <a href="{% url 'nueva_compra' %}" style="padding: 10px 15px; background-color: #3949ab; color: white; text-decoration: none; border-radius: 6px; font-weight: bold;">
        ğŸ›’ Registrar Compra
    </a>
    <a href="{% url 'nueva_nomina' %}" style="padding: 10px 15px; background-color: #43a047; color: white; text-decoration: none; border-radius: 6px; font-weight: bold;">
        ğŸ’° Registrar NÃ³mina
    </a>
</div>

<table style="width:90%; margin:auto; border-collapse:collapse;">
    <thead>
        <tr style="background:#4CAF50; color:white;">
            <th>Folio</th>
            <th>Cliente</th>
            <th>Fecha</th>
            <th>Hora</th>
            <th>Pagado</th>
            <th>Total</th>
            <th>Acciones</th>
        </tr>
    </thead>
    <tbody>
    {% for r, productos in rentas %}
        {% if not tipo_filtrado or productos.exists %}
            <tr style="background:{% cycle 'white' '#fafafa' %};">
                <td>{{ r.folio }}</td>
                <td>{{ r.cliente.nombre }}</td>
                <td>{{ r.fecha_renta }}</td>
                <td>{{ r.hora_inicio }} - {{ r.hora_fin }}</td>
                <td>
                    {% if r.finanza.pagado %}
                        <span style="color:green;">âœ” Pagado</span>
                    {% else %}
                        <span style="color:red;">âŒ Pendiente</span>
                    {% endif %}
                </td>
                <td>${{ r.finanza.total }}</td>
                <td>
                    <a href="{% url 'editar_renta' r.id %}" style="padding:5px 10px; background:#2196F3; color:white; text-decoration:none; border-radius:5px;">âœï¸ Editar</a>

                    {% if not r.finanza.pagado %}
                        <a href="{% url 'cont_pagar' r.id %}" style="padding:5px 10px; background:green; color:white; text-decoration:none; border-radius:5px;">âœ” Marcar Pagado</a>
                    {% else %}
                        <a href="{% url 'cont_pendiente' r.id %}" style="padding:5px 10px; background:red; color:white; text-decoration:none; border-radius:5px;">âŒ Marcar Pendiente</a>
                    {% endif %}
                </td>
            </tr>
        {% endif %}
    {% empty %}
        <tr>
            <td colspan="7" style="text-align:center; padding:20px;">No hay rentas en esta semana.</td>
        </tr>
    {% endfor %}
    </tbody>
</table>

<!-- Totales -->
<h3 style="text-align:center; margin-top:30px;">ğŸ“Š Resumen</h3>
<ul style="width:90%; margin:auto;">
    <li>Total ventas: ${{ total_ventas|floatformat:2 }}</li>
    <li>Total fletes: ${{ total_fletes|floatformat:2 }}</li>
    <li>Total pagado: ${{ total_pagado|floatformat:2 }}</li>
    <li>Pendiente por cobrar: ${{ total_pendiente|floatformat:2 }}</li>
</ul>

{% endblock %}